<html><head><base href="https://kanjisrs.com/">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kanji SRS Practice</title>
<meta name="google-signin-client_id" content="YOUR_CLIENT_ID.apps.googleusercontent.com">
<script src="https://apis.google.com/js/api.js"></script>
<script src="https://accounts.google.com/gsi/client"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&family=Space+Grotesk:wght@300;400;500&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Space Grotesk', sans-serif;
    background-color: #121212;
    color: #e0e0e0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    margin: 0;
    padding: 20px;
    box-sizing: border-box;
    overflow-x: hidden;
}

.container {
    text-align: center;
    max-width: 600px;
    width: 100%;
    position: relative;
    padding-bottom: 60px;
}

.kanji-display {
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 120px;
    margin-bottom: 30px;
    background-color: #1e1e1e;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    position: relative;
}

.voice-button {
    position: absolute;
    top: 10px;
    right: 10px;
    background-color: #3a3a3a;
    color: #ffffff;
    border: none;
    padding: 10px;
    font-size: 18px;
    cursor: pointer;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.voice-button:hover {
    background-color: #4a4a4a;
}

input[type="text"] {
    width: 100%;
    padding: 10px;
    font-size: 18px;
    font-family: 'Space Grotesk', sans-serif;
    background-color: #2a2a2a;
    border: none;
    border-radius: 5px;
    color: #e0e0e0;
}

.feedback {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    font-size: 18px;
    padding: 10px;
    border-radius: 5px;
    transition: opacity 0.3s ease-in-out, background-color 0.3s, color 0.3s;
    opacity: 0;
    visibility: hidden;
}

.feedback.show {
    opacity: 1;
    visibility: visible;
}

.feedback.correct {
    background-color: rgba(0, 255, 0, 0.1);
    color: #4caf50;
}

.feedback.incorrect {
    background-color: rgba(255, 0, 0, 0.1);
    color: #f44336;
}

.score {
    position: absolute;
    top: 20px;
    right: 20px;
    font-size: 18px;
    background-color: #2a2a2a;
    padding: 10px;
    border-radius: 5px;
}

.stats {
    position: absolute;
    bottom: 20px;
    right: 20px;
    font-size: 14px;
    background-color: #2a2a2a;
    padding: 10px;
    border-radius: 5px;
    text-align: right;
}

.menu-button {
    position: absolute;
    top: 20px;
    left: 20px;
    font-size: 24px;
    background-color: #2a2a2a;
    color: #e0e0e0;
    border: none;
    padding: 5px 10px;
    cursor: pointer;
    border-radius: 5px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
}

.sidebar {
    position: fixed;
    top: 0;
    left: -300px;
    width: 300px;
    height: 100%;
    background-color: #1e1e1e;
    transition: left 0.3s ease-in-out;
    overflow-y: auto;
    padding: 20px;
    box-sizing: border-box;
    z-index: 1000;
    scrollbar-width: thin;
    scrollbar-color: #4a4a4a #1e1e1e;
    box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
}

.sidebar::-webkit-scrollbar {
    width: 8px;
}

.sidebar::-webkit-scrollbar-track {
    background: #1e1e1e;
}

.sidebar::-webkit-scrollbar-thumb {
    background-color: #4a4a4a;
    border-radius: 4px;
    border: 2px solid #1e1e1e;
}

.sidebar.open {
    left: 0;
}

.sidebar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.sidebar-close, .sidebar-pin {
    font-size: 24px;
    background: none;
    border: none;
    color: #e0e0e0;
    cursor: pointer;
    padding: 5px;
}

.sidebar-pin {
    font-size: 18px;
    margin-right: 10px;
}

.sidebar-pin:hover {
    background-color: #2a2a2a;
}

.sidebar-pin.active {
    background-color: #4caf50;
}

.kanji-list {
    list-style-type: none;
    padding: 0;
}

.kanji-item {
    background-color: #2a2a2a;
    margin-bottom: 10px;
    padding: 10px;
    border-radius: 5px;
}

.kanji-item h3 {
    margin: 0 0 5px 0;
}

.kanji-item p {
    margin: 0;
    font-size: 14px;
}

.add-kanji-form {
    margin-bottom: 20px;
    display: flex;
    gap: 10px;
}

.add-kanji-form input {
    flex-grow: 1;
    padding: 5px;
    font-size: 16px;
    background-color: #2a2a2a;
    border: none;
    border-radius: 5px;
    color: #e0e0e0;
}

.add-kanji-form button {
    padding: 5px 10px;
    font-size: 16px;
    background-color: #4a4a4a;
    color: #e0e0e0;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    white-space: nowrap;
}

.import-export-buttons {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
}

.import-export-buttons button {
    padding: 5px 10px;
    font-size: 14px;
    background-color: #4a4a4a;
    color: #e0e0e0;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.modal {
    display: none;
    position: fixed;
    z-index: 1001;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    justify-content: center;
    align-items: center;
}

.modal-content {
    background-color: #1e1e1e;
    padding: 20px;
    border-radius: 5px;
    width: 340px;
    max-width: 90%;
}

.modal-content h2 {
    margin-top: 0;
    color: #e0e0e0;
}

.modal-content input {
    width: calc(100% - 20px);
    padding: 10px;
    margin: 10px 0;
    font-size: 16px;
    background-color: #2a2a2a;
    border: none;
    border-radius: 5px;
    color: #e0e0e0;
}

#import-data {
    width: 100%;
    height: 200px;
    margin-bottom: 10px;
    padding: 10px;
    font-size: 14px;
    background-color: #2a2a2a;
    border: none;
    border-radius: 5px;
    color: #e0e0e0;
    resize: vertical;
}

.modal-buttons {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
}

.modal-buttons button {
    padding: 10px 20px;
    font-size: 16px;
    background-color: #4a4a4a;
    color: #e0e0e0;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.modal-buttons button:hover {
    background-color: #5a5a5a;
}

#googleSignInButton, #signOutButton {
    background-color: #4285F4;
    color: white;
    border: none;
    padding: 10px 20px;
    margin-top: 20px;
    cursor: pointer;
    font-size: 16px;
    border-radius: 5px;
}

#googleSignInButton:hover, #signOutButton:hover {
    background-color: #357ae8;
}
</style>
</head>
<body>
<button class="menu-button" onclick="toggleSidebar()">â˜°</button>
<div class="container">
    <div class="kanji-display" id="kanji">
        <button class="voice-button" onclick="speakWord()" title="Speak (End key)">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
            </svg>
        </button>
    </div>
    <input type="text" id="answer" placeholder="Type the hiragana pronunciation">
    <div class="feedback" id="feedback"></div>
</div>
<div class="score" id="score">Score: 0/0</div>
<div class="stats" id="stats"></div>

<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <h2>Word List</h2>
        <div>
            <button class="sidebar-pin" id="sidebar-pin" onclick="togglePin()" title="Pin sidebar">ðŸ“Œ</button>
            <button class="sidebar-close" onclick="closeSidebar()">Ã—</button>
        </div>
    </div>
    <div class="add-kanji-form">
        <input type="text" id="new-word" placeholder="Enter a kanji or word">
        <button onclick="addNewWord()">Add</button>
    </div>
    <div class="import-export-buttons">
        <button onclick="exportData()">Export Data</button>
        <button onclick="showImportModal()">Import Data</button>
    </div>
    <div id="googleSignInButton"></div>
    <button id="signOutButton" style="display: none;">Sign Out</button>
    <ul class="kanji-list" id="kanji-list"></ul>
</div>

<div id="import-modal" class="modal">
    <div class="modal-content">
        <h2>Import Data</h2>
        <textarea id="import-data" placeholder="Paste your exported data here" rows="10"></textarea>
        <div class="modal-buttons">
            <button onclick="importData()">Import</button>
            <button onclick="closeImportModal()">Cancel</button>
        </div>
    </div>
</div>

<div id="manual-input-modal" class="modal">
    <div class="modal-content">
        <h2>Add Word Manually</h2>
        <input type="text" id="manual-word" placeholder="Word" required>
        <input type="text" id="manual-pronunciation" placeholder="Pronunciation (Hiragana)" required>
        <input type="text" id="manual-meaning" placeholder="Meaning" required>
        <input type="text" id="manual-level" placeholder="JLPT Level (optional)">
        <div class="modal-buttons">
            <button onclick="addWordManually()">Add Word</button>
            <button onclick="closeManualInputForm()">Cancel</button>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
<script>
let kanjiList = [
    { word: 'æ°´', pronunciation: 'ã¿ãš', meaning: 'water' },
    { word: 'ç«', pronunciation: 'ã²', meaning: 'fire' },
    { word: 'æœ¨', pronunciation: 'ã', meaning: 'tree' },
    { word: 'å±±', pronunciation: 'ã‚„ã¾', meaning: 'mountain' },
    { word: 'å·', pronunciation: 'ã‹ã‚', meaning: 'river' },
    { word: 'æ—¥', pronunciation: 'ã²', meaning: 'sun, day' },
    { word: 'æœˆ', pronunciation: 'ã¤ã', meaning: 'moon, month' },
    { word: 'äºº', pronunciation: 'ã²ã¨', meaning: 'person' },
    { word: 'çŠ¬', pronunciation: 'ã„ã¬', meaning: 'dog' },
    { word: 'çŒ«', pronunciation: 'ã­ã“', meaning: 'cat' }
];

let currentKanji = {};
let correctAnswers = 0;
let totalAttempts = 0;
let srsData = {};
let sidebarPinned = false;
let isSignedIn = false;
const CLIENT_ID = 'YOUR_CLIENT_ID.apps.googleusercontent.com';
const API_KEY = 'YOUR_API_KEY';
const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];
const SCOPES = 'https://www.googleapis.com/auth/drive.file';

function getNextKanji() {
    const now = Date.now();
    const dueItems = kanjiList.filter(item => !srsData[item.word] || srsData[item.word].nextReview <= now);
    
    if (dueItems.length === 0) {
        return _.sample(kanjiList);
    }
    
    return _.minBy(dueItems, item => srsData[item.word] ? srsData[item.word].interval : 0);
}

function updateSRS(word, correct) {
    if (!srsData[word]) {
        srsData[word] = { interval: 1, nextReview: Date.now() };
    }
    
    if (correct) {
        srsData[word].interval *= 2;
    } else {
        srsData[word].interval = 1;
    }
    
    srsData[word].nextReview = Date.now() + srsData[word].interval * 24 * 60 * 60 * 1000;
}

function loadKanji() {
    currentKanji = getNextKanji();
    document.getElementById('kanji').textContent = currentKanji.word;
    document.getElementById('answer').value = '';
    hideFeedback();
    updateStats();
}

function checkAnswer() {
    const userAnswer = document.getElementById('answer').value.trim();
    const correct = userAnswer === currentKanji.pronunciation;
    
    updateSRS(currentKanji.word, correct);
    totalAttempts++;
    
    const feedbackElement = document.getElementById('feedback');
    
    if (correct) {
        correctAnswers++;
        showFeedback('Correct!', 'correct');
        setTimeout(() => {
            hideFeedback();
            setTimeout(loadKanji, 300);
        }, 1700);
    } else {
        showFeedback(`Incorrect. The correct answer is ${currentKanji.pronunciation} (${currentKanji.meaning}).`, 'incorrect');
        setTimeout(() => {
            hideFeedback();
            setTimeout(loadKanji, 300);
        }, 3700);
    }
    
    document.getElementById('score').textContent = `Score: ${correctAnswers}/${totalAttempts}`;
    updateStats();
}

function showFeedback(message, className) {
    const feedbackElement = document.getElementById('feedback');
    feedbackElement.textContent = message;
    feedbackElement.className = `feedback ${className}`;
    setTimeout(() => feedbackElement.classList.add('show'), 10);
}

function hideFeedback() {
    const feedbackElement = document.getElementById('feedback');
    feedbackElement.classList.remove('show');
}

function speakWord() {
    if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(currentKanji.pronunciation);
        utterance.lang = 'ja-JP';
        speechSynthesis.speak(utterance);
    } else {
        alert('Sorry, your browser does not support text-to-speech!');
    }
}

function updateStats() {
    const totalWords = kanjiList.length;
    const uniqueKanji = new Set(kanjiList.map(item => item.word)).size;
    const learnedKanji = correctAnswers;
    
    const statsElement = document.getElementById('stats');
    statsElement.innerHTML = `
        Words in deck: ${totalWords}<br>
        Unique kanji: ${uniqueKanji}<br>
        Learned so far: ${learnedKanji}
    `;
}

function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('open');
    if (sidebar.classList.contains('open')) {
        updateKanjiList();
    }
}

function closeSidebar() {
    if (!sidebarPinned) {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.remove('open');
    }
}

function togglePin() {
    sidebarPinned = !sidebarPinned;
    const pinButton = document.getElementById('sidebar-pin');
    pinButton.classList.toggle('active', sidebarPinned);
    pinButton.textContent = 'ðŸ“Œ';
}

async function fetchWordData(word) {
    try {
        const response = await fetch(`https://jlpt-vocab-api.vercel.app/api/words?word=${encodeURIComponent(word)}`);
        const data = await response.json();
        if (data.words && data.words.length > 0) {
            const firstResult = data.words[0];
            return {
                word: firstResult.word,
                pronunciation: firstResult.furigana,
                meaning: firstResult.meaning,
                level: firstResult.level
            };
        }
        return null;
    } catch (error) {
        console.error('Error fetching word data:', error);
        return null;
    }
}

async function addNewWord() {
    const newWordInput = document.getElementById('new-word');
    const word = newWordInput.value.trim();
    
    if (word.length === 0) {
        alert('Please enter a kanji or word.');
        return;
    }
    
    const existingWord = kanjiList.find(item => item.word === word);
    if (existingWord) {
        alert('This word is already in the list.');
        return;
    }
    
    const wordData = await fetchWordData(word);
    if (wordData) {
        kanjiList.push(wordData);
        newWordInput.value = '';
        updateKanjiList();
        alert('Word added successfully!');
    } else {
        showManualInputForm(word);
    }
}

function showManualInputForm(word) {
    document.getElementById('manual-word').value = word;
    document.getElementById('manual-input-modal').style.display = 'flex';
}

function addWordManually() {
    const word = document.getElementById('manual-word').value.trim();
    const pronunciation = document.getElementById('manual-pronunciation').value.trim();
    const meaning = document.getElementById('manual-meaning').value.trim();
    const level = document.getElementById('manual-level').value.trim();

    if (word && pronunciation && meaning) {
        kanjiList.push({
            word: word,
            pronunciation: pronunciation,
            meaning: meaning,
            level: level || 'N/A'
        });
        updateKanjiList();
        closeManualInputForm();
        alert('Word added successfully!');
    } else {
        alert('Please fill in all required fields.');
    }
}

function closeManualInputForm() {
    document.getElementById('manual-input-modal').style.display = 'none';
    document.getElementById('manual-word').value = '';
    document.getElementById('manual-pronunciation').value = '';
    document.getElementById('manual-meaning').value = '';
    document.getElementById('manual-level').value = '';
}

function updateKanjiList() {
    const wordListElement = document.getElementById('kanji-list');
    wordListElement.innerHTML = '';
    kanjiList.sort((a, b) => a.word.localeCompare(b.word)).forEach(word => {
        const li = document.createElement('li');
        li.className = 'kanji-item';
        li.innerHTML = `
            <h3>${word.word}</h3>
            <p>Pronunciation: ${word.pronunciation}</p>
            <p>Meaning: ${word.meaning}</p>
            <p>Level: ${word.level || 'N/A'}</p>
            <p>Interval: ${srsData[word.word] ? srsData[word.word].interval : 1} days</p>
        `;
        wordListElement.appendChild(li);
    });
}

function exportData() {
    const data = {
        kanjiList: kanjiList,
        srsData: srsData,
        correctAnswers: correctAnswers,
        totalAttempts: totalAttempts
    };
    const jsonData = JSON.stringify(data);
    const blob = new Blob([jsonData], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'kanji_srs_data.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);

    if (isSignedIn) {
        checkMokuroSRSFolder();
    }
}

function showImportModal() {
    document.getElementById('import-modal').style.display = 'flex';
}

function closeImportModal() {
    document.getElementById('import-modal').style.display = 'none';
    document.getElementById('import-data').value = '';
}

function importData() {
    const importedData = document.getElementById('import-data').value;
    try {
        const data = JSON.parse(importedData);
        kanjiList = data.kanjiList || [];
        srsData = data.srsData || {};
        correctAnswers = data.correctAnswers || 0;
        totalAttempts = data.totalAttempts || 0;
        
        updateKanjiList();
        updateStats();
        document.getElementById('score').textContent = `Score: ${correctAnswers}/${totalAttempts}`;
        loadKanji();
        closeImportModal();
        alert('Data imported successfully!');
    } catch (error) {
        alert('Error importing data. Please check the format and try again.');
    }
}

function initializeGoogleAPI() {
    gapi.load('client', initClient);
}

function initClient() {
    gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: DISCOVERY_DOCS,
        scope: SCOPES
    }).then(() => {
        google.accounts.id.initialize({
            client_id: CLIENT_ID,
            callback: handleCredentialResponse
        });
        google.accounts.id.renderButton(
            document.getElementById('googleSignInButton'),
            { theme: 'outline', size: 'large' }
        );
        checkSignInStatus();
    }).catch(error => {
        console.error('Error initializing Google API client:', error);
    });
}

function handleCredentialResponse(response) {
    if (response.credential) {
        updateSignInStatus(true);
    }
}

function updateSignInStatus(signedIn) {
    isSignedIn = signedIn;
    if (signedIn) {
        document.getElementById('googleSignInButton').style.display = 'none';
        document.getElementById('signOutButton').style.display = 'block';
        checkMokuroSRSFolder();
    } else {
        document.getElementById('googleSignInButton').style.display = 'block';
        document.getElementById('signOutButton').style.display = 'none';
    }
}

function handleSignOutClick() {
    google.accounts.id.disableAutoSelect();
    updateSignInStatus(false);
}

function checkSignInStatus() {
    google.accounts.id.prompt((notification) => {
        if (notification.isNotDisplayed() || notification.isSkippedMoment()) {
            updateSignInStatus(false);
        }
    });
}

function checkMokuroSRSFolder() {
    gapi.client.drive.files.list({
        q: "name='mokuroSRS' and mimeType='application/vnd.google-apps.folder'",
        fields: 'files(id, name)'
    }).then((response) => {
        const files = response.result.files;
        if (files && files.length > 0) {
            loadDataFromDrive(files[0].id);
        } else {
            createMokuroSRSFolder();
        }
    });
}

function createMokuroSRSFolder() {
    gapi.client.drive.files.create({
        resource: {
            name: 'mokuroSRS',
            mimeType: 'application/vnd.google-apps.folder'
        },
        fields: 'id'
    }).then((response) => {
        const folderId = response.result.id;
        saveDataToDrive(folderId);
    });
}

function loadDataFromDrive(folderId) {
    gapi.client.drive.files.list({
        q: `'${folderId}' in parents and name='kanji_srs_data.json'`,
        fields: 'files(id, name)'
    }).then((response) => {
        const files = response.result.files;
        if (files && files.length > 0) {
            gapi.client.drive.files.get({
                fileId: files[0].id,
                alt: 'media'
            }).then((response) => {
                const data = JSON.parse(response.body);
                kanjiList = data.kanjiList || [];
                srsData = data.srsData || {};
                correctAnswers = data.correctAnswers || 0;
                totalAttempts = data.totalAttempts || 0;
                updateKanjiList();
                updateStats();
                document.getElementById('score').textContent = `Score: ${correctAnswers}/${totalAttempts}`;
                loadKanji();
            });
        }
    });
}

function saveDataToDrive(folderId) {
    const data = {
        kanjiList: kanjiList,
        srsData: srsData,
        correctAnswers: correctAnswers,
        totalAttempts: totalAttempts
    };
    const jsonData = JSON.stringify(data);

    gapi.client.drive.files.create({
        resource: {
            name: 'kanji_srs_data.json',
            parents: [folderId]
        },
        media: {
            mimeType: 'application/json',
            body: jsonData
        }
    }).then(() => {
        console.log('Data saved to Google Drive');
    });
}

// Initialize Google API when the page loads
window.onload = initializeGoogleAPI;

loadKanji();

document.getElementById('answer').addEventListener('keypress', function(event) {
    if (event.key === 'Enter') {
        checkAnswer();
    }
});

document.addEventListener('keydown', function(event) {
    if (event.key === 'End') {
        speakWord();
    }
});

document.addEventListener('click', function(event) {
    const sidebar = document.getElementById('sidebar');
    const menuButton = document.querySelector('.menu-button');
    if (!sidebar.contains(event.target) && !menuButton.contains(event.target) && !sidebarPinned) {
        closeSidebar();
    }
});
</script>
</body></html>